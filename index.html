<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Protected README</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 1rem; max-width: 900px; margin: auto; }
    input { padding: .5rem; width: 300px; }
    button { padding: .5rem 1rem; }
    #output { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Protected README</h1>
  <p>Enter key to view content:</p>
  <input id="pw" type="password" placeholder="Password">
  <button id="go">Unlock</button>
  <div id="msg"></div>
  <div id="output"></div>

  <!-- CryptoJS and marked (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
  // Option 1: fetch external JSON (README.enc.json)
  // Option 2: paste the JSON below in place of `enc`
  async function loadEncrypted() {
    try {
      const r = await fetch('README.enc.json');
      if (!r.ok) throw new Error('No encrypted file found (404)');
      return await r.json();
    } catch (e) {
      // fallback: try inline `enc` variable (if you paste the JSON by hand)
      if (typeof enc !== 'undefined') return enc;
      throw e;
    }
  }

  async function decrypt(encObj, password) {
    // Derive key using PBKDF2 to match the Node script
    const saltWA = CryptoJS.enc.Hex.parse(encObj.salt);
    const key = CryptoJS.PBKDF2(password, saltWA, { keySize: 256/32, iterations: 10000 });
    const iv = CryptoJS.enc.Hex.parse(encObj.iv);
    // Ciphertext as WordArray (CryptoJS expects ciphertext as Base64 inside a CipherParams object)
    const ctWA = CryptoJS.enc.Base64.parse(encObj.ciphertext);
    const cipherParams = CryptoJS.lib.CipherParams.create({ ciphertext: ctWA });
    const decrypted = CryptoJS.AES.decrypt(cipherParams, key, { iv: iv });
    const text = decrypted.toString(CryptoJS.enc.Utf8);
    return text;
  }

  document.getElementById('go').addEventListener('click', async () => {
    const pw = document.getElementById('pw').value || '';
    const msg = document.getElementById('msg');
    msg.textContent = 'Trying...';
    try {
      const enc = await loadEncrypted();
      const plain = await decrypt(enc, pw);
      if (!plain) throw new Error('Decryption failed (empty result)');
      msg.textContent = '';
      const out = document.getElementById('output');
      out.innerHTML = marked.parse(plain);
    } catch (err) {
      msg.textContent = 'Wrong key or error: ' + err.message;
    }
  });
  </script>
</body>
</html>
